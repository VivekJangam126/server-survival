<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Leaderboard - SERVER: Survival Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body class="bg-gray-900 text-white dashboard-page" style="min-height: 100vh;">
    <!-- Shared navbar will be loaded here -->
    <div id="navbar-container"></div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Page Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 mb-2">
                Debug Leaderboard
            </h1>
            <p class="text-gray-400">Testing leaderboard functionality</p>
        </div>

        <!-- Debug Info -->
        <div class="glass-panel rounded-xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Debug Information</h2>
            <div id="debug-info" class="space-y-2 text-sm font-mono">
                <div>Status: <span id="debug-status" class="text-yellow-400">Loading...</span></div>
                <div>Current URL: <span id="debug-url" class="text-blue-400"></span></div>
                <div>Base URL: <span id="debug-base" class="text-green-400"></span></div>
                <div>Errors: <span id="debug-errors" class="text-red-400">None</span></div>
            </div>
        </div>

        <!-- Test Buttons -->
        <div class="glass-panel rounded-xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Test Functions</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="testNavigation()" class="bg-blue-600 hover:bg-blue-500 text-white py-2 px-4 rounded">
                    Test Navigation
                </button>
                <button onclick="testImports()" class="bg-green-600 hover:bg-green-500 text-white py-2 px-4 rounded">
                    Test Imports
                </button>
                <button onclick="testData()" class="bg-purple-600 hover:bg-purple-500 text-white py-2 px-4 rounded">
                    Test Data
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="glass-panel rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4">Test Results</h2>
            <div id="test-results" class="space-y-2 text-sm">
                <div class="text-gray-400">Click test buttons to see results...</div>
            </div>
        </div>
    </div>

    <script>
        // Debug functions
        function updateDebugInfo() {
            document.getElementById('debug-url').textContent = window.location.href;
            document.getElementById('debug-base').textContent = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
        }

        function logResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-400';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        function testNavigation() {
            logResult('Testing navigation paths...');
            
            // Test relative path resolution
            const currentPath = window.location.pathname;
            logResult(`Current path: ${currentPath}`);
            
            const isInSubdirectory = currentPath.includes('/') && !currentPath.endsWith('/') && currentPath !== '/index.html';
            logResult(`In subdirectory: ${isInSubdirectory}`);
            
            if (isInSubdirectory) {
                const pathParts = currentPath.split('/').filter(part => part && part !== 'index.html');
                const depth = pathParts.length - 1;
                logResult(`Directory depth: ${depth}`);
                
                const backPath = '../'.repeat(depth);
                logResult(`Back path: ${backPath}`);
                
                const testUrl = 'challenges/challenges.html';
                const resolvedUrl = backPath + testUrl;
                logResult(`Test URL: ${testUrl} -> ${resolvedUrl}`);
            }
        }

        async function testImports() {
            logResult('Testing module imports...');
            
            try {
                // Test importing leaderboard constants
                logResult('Importing leaderboard constants...');
                const constants = await import('./leaderboard.constants.js');
                logResult('✓ Leaderboard constants imported successfully', 'success');
                
                // Test importing datasource
                logResult('Importing datasource...');
                const datasource = await import('./mcqLeaderboard.datasource.js');
                logResult('✓ Datasource imported successfully', 'success');
                
                // Test importing logic
                logResult('Importing logic...');
                const logic = await import('./mcqLeaderboard.logic.js');
                logResult('✓ Logic imported successfully', 'success');
                
                // Test importing MCQ data
                logResult('Importing MCQ data...');
                const mcqData = await import('../src/challenges/mcq.data.js');
                logResult('✓ MCQ data imported successfully', 'success');
                
                document.getElementById('debug-status').textContent = 'All imports successful';
                document.getElementById('debug-status').className = 'text-green-400';
                
            } catch (error) {
                logResult(`✗ Import failed: ${error.message}`, 'error');
                document.getElementById('debug-status').textContent = 'Import failed';
                document.getElementById('debug-status').className = 'text-red-400';
                document.getElementById('debug-errors').textContent = error.message;
            }
        }

        async function testData() {
            logResult('Testing data access...');
            
            try {
                // Import modules
                const { getAllChallenges } = await import('../src/challenges/mcq.data.js');
                const { getAllChallengesWithAttempts } = await import('./mcqLeaderboard.datasource.js');
                const { getLeaderboardForChallenge } = await import('./mcqLeaderboard.logic.js');
                
                // Test getting challenges
                const allChallenges = getAllChallenges();
                logResult(`Found ${allChallenges.length} total challenges`, 'success');
                
                // Test getting challenges with attempts
                const challengesWithAttempts = getAllChallengesWithAttempts();
                logResult(`Found ${challengesWithAttempts.length} challenges with attempts`, 'success');
                
                // Test getting leaderboard for first challenge
                if (challengesWithAttempts.length > 0) {
                    const firstChallenge = challengesWithAttempts[0];
                    const leaderboard = getLeaderboardForChallenge(firstChallenge);
                    logResult(`Leaderboard for ${firstChallenge}: ${leaderboard.leaderboard.length} entries`, 'success');
                } else {
                    logResult('No challenges with attempts found - this is normal if no test data exists', 'info');
                }
                
            } catch (error) {
                logResult(`✗ Data test failed: ${error.message}`, 'error');
            }
        }

        // Load shared navbar
        async function loadSharedNavbar() {
            try {
                const response = await fetch('../shared/navbar.html');
                const navbarHtml = await response.text();
                document.getElementById('navbar-container').innerHTML = navbarHtml;
                
                // Load navbar script
                const script = document.createElement('script');
                script.src = '../shared/navbar.js';
                document.head.appendChild(script);
                
                logResult('✓ Navbar loaded successfully', 'success');
            } catch (error) {
                logResult(`✗ Failed to load navbar: ${error.message}`, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDebugInfo();
            loadSharedNavbar();
            logResult('Debug page initialized');
        });
    </script>
</body>
</html>