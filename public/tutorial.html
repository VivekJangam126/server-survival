<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial | Server Survival</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <!-- Shared Navbar Loader -->
  <script type="module" src="/shared/navbar/navbar.js"></script>

  <!-- Project Styles -->
  <link rel="stylesheet" href="/styles/global.css" />

  <style>
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Scrollable body */
    body {
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    /* Custom scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(56, 189, 248, 0.3);
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(56, 189, 248, 0.5);
    }
    
    /* Firefox scrollbar */
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(56, 189, 248, 0.3) rgba(15, 23, 42, 0.5);
    }
    
    /* Glass panel style for consistency */
    .glass-panel {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(56, 189, 248, 0.1);
      backdrop-filter: blur(10px);
    }
  </style>
</head>

<body class="bg-[#050505] text-gray-100">

  <!-- Navbar injected by JS -->
  <div id="navbar-root"></div>

  <!-- Main Content Container -->
  <main id="tutorial-page-container" class="pt-20 pb-16 min-h-screen">
    <!-- TutorialDetailPage will render here -->
    <div class="flex items-center justify-center h-64">
      <div class="text-center">
        <div class="animate-spin w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full mx-auto mb-4"></div>
        <p class="text-gray-400">Loading Tutorial...</p>
      </div>
    </div>
  </main>

  <!-- Tutorial Page Scripts (ES6 Modules) -->
  <script type="module">
    import { TutorialDetailPage } from '/src/pages/TutorialDetailPage.js';

    // Get concept ID from URL query parameter
    function getConceptId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id') || urlParams.get('concept');
    }

    // Initialize Tutorial Page when DOM is ready
    document.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('tutorial-page-container');
      const conceptId = getConceptId();
      
      if (!conceptId) {
        container.innerHTML = `
          <div class="max-w-4xl mx-auto p-6 text-center">
            <h1 class="text-2xl font-bold text-yellow-400 mb-4">No Tutorial Selected</h1>
            <p class="text-gray-400 mb-4">Please select a tutorial from the Learn Mode page.</p>
            <a href="/public/learn.html" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 inline-block">
              Go to Learn Mode
            </a>
          </div>
        `;
        return;
      }
      
      const tutorialPage = new TutorialDetailPage();
      
      try {
        await tutorialPage.initialize(container, conceptId);
        // Update page title
        if (tutorialPage.tutorial) {
          document.title = `${tutorialPage.tutorial.title} | Server Survival`;
        }
      } catch (error) {
        console.error('Failed to initialize Tutorial Page:', error);
        container.innerHTML = `
          <div class="max-w-4xl mx-auto p-6 text-center">
            <h1 class="text-2xl font-bold text-red-400 mb-4">Failed to Load</h1>
            <p class="text-gray-400 mb-4">There was an error loading this tutorial.</p>
            <a href="/public/learn.html" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 inline-block">
              Back to Learn Mode
            </a>
          </div>
        `;
      }
    });
  </script>

</body>
</html>
